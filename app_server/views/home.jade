extends layout
include _includes/sharedHTMLfunctions

block content
  .row.banner
    .col-12.text-center  
      img(src="images/roastlogo.jpg", alt="Roast Logo", class="img-fluid", style="max-width: 800px;") 
      h1 Welcome to Roast CafÃ©
      p Discover the finest coffees and pastries made with love and local ingredients.

  // Main Content Area
  .row
    .col-12.col-md-8
      // Coffee Section
      .card
        .card-block
          h4
            a(href="/location") Coffee
          .row
            .col-6
              p.facilities
                span.badge.badge-warning Coffee is a beloved beverage made from roasted coffee beans.
                span.badge.badge-warning The seeds of the Coffea plant. Ground and brewed with hot water,
                span.badge.badge-warning it offers a rich array of flavors and aromas. Enjoyed globally in 
                span.badge.badge-warning forms like espresso, lattes, and cold brews.
                span.badge.badge-warning Coffee is celebrated for its stimulating effects due to caffeine.
                span.badge.badge-warning Beyond its taste, coffee holds cultural significance, often serving 
                span.badge.badge-warning as a social catalyst in gatherings and daily routines, making it a 
                span.badge.badge-warning cherished part of many people's lives.
            .col-6
              img(src="images/coffee.jpg", alt="Cappuccino Image", class="img-fluid")

      // Pastries Section
      .card
        .card-block
          h4
            a(href="/pastries") Pastries
          .row
            .col-6
              p.facilities
                span.badge.badge-warning Pastries are delightful baked goods made from ingredients like flour,
                span.badge.badge-warning butter, and sugar, offering a range of sweet and savory flavors.
                span.badge.badge-warning From buttery croissants to rich chocolate muffins, pastries
                span.badge.badge-warning provide a delicious treat for any time of day. These confections are 
                span.badge.badge-warning often enjoyed with coffee or tea, adding a touch of indulgence 
                span.badge.badge-warning to morning routines or snack times.
            .col-6
              img(src="images/pastrylogo.jpg", alt="Pastries Image", class="img-fluid")

      // Tea Section
      .card
        .card-block
          h4
            a(href="/tea") Tea
          .row
            .col-6
              p.facilities
                span.badge.badge-warning Tea is a popular beverage made by steeping cured or fresh 
                span.badge.badge-warning tea leaves in hot water. It comes in various types, including black, 
                span.badge.badge-warning green, white, and herbal, each offering unique flavors 
                span.badge.badge-warning and health benefits. Enjoyed both hot and cold, tea is a staple in
                span.badge.badge-warning many cultures worldwide.
            .col-6
              img(src="images/tea.jpg", alt="Tea Image", class="img-fluid")

      // Sandwiches Section
      .card
        .card-block
          h4
            a(href="/sandwiches") Sandwiches
          .row
            .col-6
              p.facilities
                span.badge.badge-warning Sandwiches are a versatile and popular food option made by 
                span.badge.badge-warning placing various fillings, such as meats, cheeses, and vegetables, 
                span.badge.badge-warning between slices of bread or in a roll. They are convenient for 
                span.badge.badge-warning lunches, picnics, or snacks, and can be customized to suit individual 
                span.badge.badge-warning tastes. Enjoy a variety of flavors from classic ham and cheese to 
                span.badge.badge-warning gourmet options like smoked salmon with cream cheese.
            .col-6
              img(src="images/sandwiches.jpg", alt="Sandwiches Image", class="img-fluid")

    // Add Review Section on the Right Side
    .col-12.col-md-4
      .card
        .card-block
          h4 Add Review
          p Share your experience with us!
          a(href="/location/review/new", class="btn btn-primary") Add Review 

      // Customer Reviews Section in a Single Card
      .card.reviews-card(style="height: 300px; overflow-y: auto; border: 1px solid #ccc;")
        .card-block
          h5 Customer Reviews
          .reviews-container(style="color: white;") // Set font color to white
            // Existing and new reviews will be dynamically appended here

    .col-12
      p.lead
        | Join us for a delightful experience, and don't forget to try our special blends and treats!

  script.
    let currentPage = 1; // Current page number
    const limit = 5; // Number of reviews to load each time
    let loading = false; // Flag to prevent multiple loads

    // Function to fetch reviews from the server
    async function fetchReviews(page) {
      if (loading) return; // Prevent loading if already in progress
      loading = true;

      const reviewsContainer = document.querySelector('.reviews-container');
      const loadingMessage = document.createElement('div');
      loadingMessage.textContent = 'Loading more reviews...';
      loadingMessage.style.textAlign = 'center';
      loadingMessage.style.padding = '10px';
      reviewsContainer.appendChild(loadingMessage); // Show loading message

      try {
        const response = await fetch(`/api/reviews?page=${page}&limit=${limit}`);
        const data = await response.json();

        // Display fetched reviews
        data.reviews.forEach(review => {
          displayNewReview(review);
        });

        currentPage++; // Increment current page for the next load
      } catch (err) {
        console.error('Error fetching reviews:', err);
      } finally {
        loading = false; // Reset loading flag
        reviewsContainer.removeChild(loadingMessage); // Hide loading message
      }
    }

    // Function to display a review dynamically in the .reviews-container
    function displayNewReview(review) {
      if (review && review.name && review.rating !== undefined && review.review) {
        const reviewsContainer = document.querySelector('.reviews-container');
        const reviewHTML = `
          <div class="card mb-2" style="min-height: 150px;"> <!-- Increase min-height for longer cards -->
            <div class="card-block">
              <h5 style="color: white;">${review.name}</h5> <!-- Set name color to white -->
              <p style="color: white;">Rating: ${review.rating}</p> <!-- Set rating color to white -->
              <p style="color: white;">${review.review}</p> <!-- Set review text color to white -->
            </div>
          </div>
        `;
        reviewsContainer.innerHTML += reviewHTML; // Append new review
      } else {
        console.warn('Received an undefined or incomplete review:', review);
      }
    }

    // Fetch initial set of reviews on page load
    fetchReviews(currentPage); // Fetch initial reviews

    // Event listener for scrolling to trigger fetching more reviews
    document.querySelector('.reviews-card').addEventListener('scroll', () => {
      const reviewsCard = document.querySelector('.reviews-card');
      // Load more reviews when the user scrolls close to the bottom of the card
      if (reviewsCard.scrollTop + reviewsCard.clientHeight >= reviewsCard.scrollHeight - 10) {
        fetchReviews(currentPage);
      }
    });
